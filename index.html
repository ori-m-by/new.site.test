<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ğŸ¬ ×¡×¨×˜×™× ×œ×¦×¤×™×™×”</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <!-- ××¡×ª×™×¨×™× ×¢×“ ×‘×“×™×§×ª ×”×¨×©××” -->
  <style>html { visibility: hidden; }</style>

  <script>
    /*****************************************************
     * 1) CONFIG â€“ ×˜×‘×œ×ª ××™×™×œ×™× ××•×¨×©×™× + Worker
     *****************************************************/
    const APPROVED_SHEET_ID   = "1EYGrBVteGM4_kXhc6owSxicwIrMp6FkzV74AjZdeAeM";
    const APPROVED_SHEET_NAME = "××™×™×œ×™× ××•×¨×©×™×";

    const WORKER_ENDPOINT = "https://royal-lab-55af.orimoshe-by.workers.dev";

    const GOOGLE_CLIENT_ID =
      "1083389812447-mst37a55gquvk05cuc8utqsuunfar6hb.apps.googleusercontent.com";

    /*****************************************************
     * 2) ×‘×§×©×” ×œÖ¾Worker ×©××—×–×™×¨ ×¢×¨×›×™ ×˜×‘×œ×” (values)
     *****************************************************/
    async function fetchSheetFromWorker(sheetId, sheetName = "") {
      const url = `${WORKER_ENDPOINT}?sheet=${sheetId}${
        sheetName ? `&name=${encodeURIComponent(sheetName)}` : ""
      }`;

      const res = await fetch(url);
      if (!res.ok) {
        const txt = await res.text().catch(() => "");
        console.error("Worker error:", res.status, txt);
        throw new Error("Worker error " + res.status);
      }
      return await res.json();
    }

    /*****************************************************
     * 3) ××—×–×™×¨ TRUE ×× ×”××™×™×œ × ××¦× ×‘×˜×‘×œ×ª ×”××•×¨×©×™×
     *****************************************************/
/*****************************************************
 * 3) ××—×–×™×¨ TRUE ×× ×”××™×™×œ × ××¦× ×‘×˜×‘×œ×ª ×”××•×¨×©×™×
 *****************************************************/
async function isEmailAllowed(email) {
  try {
    const data = await fetchSheetFromWorker(APPROVED_SHEET_ID, APPROVED_SHEET_NAME);

    // â— ×”Ö¾Worker ××—×–×™×¨ data.values ×•×œ× valueRanges
    const values = data.values;
    if (!values || values.length < 2) {
      console.error("No rows in allowed emails sheet");
      return false;
    }

    // ×©×•×¨×” ×¨××©×•× ×” ×›×•×ª×¨×ª, ×”×©××¨ ××™×™×œ×™×
    const emails = values
      .slice(1)
      .map(row => (row[0] || "").trim().toLowerCase())
      .filter(Boolean);

    return emails.includes(email.toLowerCase());
  } catch (e) {
    console.error("Error checking allowed emails:", e);
    return false;
  }
}


    /*****************************************************
     * 4) callback ×©×œ ×”×ª×—×‘×¨×•×ª ×’×•×’×œ
     *****************************************************/
    function handleCredentialResponse(res) {
      (async () => {
        try {
          const data = parseJwt(res.credential);
          const email = data.email;

          const ok = await isEmailAllowed(email);
          if (!ok) {
            alert("âŒ ××™×Ÿ ×œ×š ×”×¨×©××” ×œ×”×™×›× ×¡ ×œ××ª×¨.");
            return;
          }

          // ×©××™×¨×ª ××™×™×œ ×××•×©×¨
          localStorage.setItem("gs_auth_email", email);

          // ×”×¦×’×ª ×”××ª×¨
          document.getElementById("gLoginBtn").style.display = "none";
          document.documentElement.style.visibility = "visible";
          document.getElementById("appContent").style.display = "block";

        } catch (e) {
          console.error("Login error:", e);
        }
      })();
    }

    /*****************************************************
     * 5) decode JWT
     *****************************************************/
    function parseJwt(token) {
      const base64Url = token.split('.')[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      const jsonPayload = decodeURIComponent(
        atob(base64).split('').map(c =>
          '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)
        ).join('')
      );
      return JSON.parse(jsonPayload);
    }

    /*****************************************************
     * 6) startLoginFlow â€“ × ×˜×¢×Ÿ ×¢× onload
     *****************************************************/
    async function startLoginFlow() {
      const saved = localStorage.getItem("gs_auth_email");

      // ×× ×›×‘×¨ ××—×•×‘×¨ ×•××©×•×™×š ×œ×˜×‘×œ×ª ×”××•×¨×©×™×
      if (saved && await isEmailAllowed(saved)) {
        document.documentElement.style.visibility = "visible";
        document.getElementById("appContent").style.display = "block";
        document.getElementById("gLoginBtn").style.display = "none";
        return;
      }

      // ××¦×™×’×™× ×›×¤×ª×•×¨ ×’×•×’×œ
      google.accounts.id.initialize({
        client_id: GOOGLE_CLIENT_ID,
        callback: handleCredentialResponse
      });

      google.accounts.id.renderButton(
        document.getElementById("gLoginBtn"),
        { theme: "outline", size: "large" }
      );

      document.documentElement.style.visibility = "visible";
    }

    window.onload = startLoginFlow;
  </script>

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >

  <!-- CSS ×©×œ×š -->
  <style>
  .bug-report-button {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 48px;
    height: 48px;
    background: #dc3545;
    color: #fff;
    font-size: 24px;
    line-height: 48px;
    text-align: center;
    border-radius: 50%;
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    text-decoration: none;
    z-index: 1000;
    cursor: pointer;
  }
  .bug-report-button::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: 60px;
    right: 50%;
    transform: translateX(50%);
    background: rgba(0,0,0,0.8);
    color: #fff;
    padding: 6px 10px;
    border-radius: 4px;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s ease;
    font-size: 14px;
  }
  .bug-report-button:hover::after { opacity: 1; }

  .movie-card {
    position: relative;
    overflow: visible;
    transition: transform 0.3s ease;
  }
  body:not(.series-mode) .movie-card:hover {
    transform: scale(1.03);
  }
  .movie-content {
    width: 60%;
    padding: 15px;
    box-sizing: border-box;
  }
  .text-extra-image {
    width: 100%;
    border-radius: 4px;
    margin-top: 10px;
  }
  .right-side {
    width: 40%;
    padding: 15px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .right-side .movie-image {
    width: 100%;
    border-radius: 8px;
  }
  .poster-extra-image {
    width: 100%;
    border-radius: 4px;
    margin-top: 10px;
  }
  .extra-info {
    display: none;
    background: rgba(255,255,255,0.95);
    padding: 20px;
  }
  .movie-card.show-info .extra-info {
    display: block;
  }
  .movie-card.show-info .text-extra-image,
  .movie-card.show-info .poster-extra-image {
    display: none !important;
  }
  .filter-bar {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin-bottom: 30px;
  }
  .trailer-container {
    width: 100%;
    height: 200px;
    border-radius: 10px;
    overflow: hidden;
    visibility: hidden;
  }
  body:not(.series-mode) .movie-card.show-info .trailer-container {
    visibility: visible;
  }

  .filter-hamburger {
    font-size: 20px;
    padding: 8px 10px;
    line-height: 1;
  }
  .dropdown-menu .form-select,
  .dropdown-menu .form-control {
    min-width: 220px;
  }
  </style>
</head>

<body class="bg-light">

  <body>

<video
  id="playerTest"
  controls
  preload="auto"
  style="width: 100%; max-width: 800px;"
>
  <source src="https://drive.google.com/uc?export=preview&id=1ViFV91ltnwvQOMx4VNhcnR3NHrahawpm" type="video/mp4">
  ×”×“×¤×“×¤×Ÿ ×©×œ×š ××™× ×• ×ª×•××š ×‘× ×’×Ÿ HTML5.
</video>


</body>

  <!-- ×›×¤×ª×•×¨ ×’×•×’×œ -->
  <div id="gLoginBtn" style="margin: 40px auto; width: fit-content;"></div>

  <!-- ×ª×•×›×Ÿ ×”××ª×¨ (××•×¡×ª×¨ ×¢×“ ×›× ×™×¡×”) -->
  <div id="appContent" style="display:none;">

    <div class="container py-5">
      <h1 class="text-center mb-3">ğŸ¬ ×”×¡×¨×˜×™× ×©×œ× ×•</h1>

      <!-- ×”×—×™×¤×•×© + ×›×¤×ª×•×¨ ×”××‘×•×¨×’×¨ -->
      <div class="filter-bar text-center mb-3">
        <div class="d-flex justify-content-center align-items-center gap-2" style="width:100%;">
          <input
            type="text"
            id="searchInput"
            class="form-control"
            style="min-width:280px; max-width:720px;"
            placeholder="×—×™×¤×•×© ×œ×¤×™ ×©×, ×‘×××™, ×©×—×§× ×™×, ×ª×™××•×¨"
            oninput="applyFilters()"
          >

          <div class="dropdown">
            <button
              id="filterBtn"
              class="btn btn-outline-secondary filter-hamburger"
              type="button"
              data-bs-toggle="dropdown"
              aria-expanded="false"
              title="×¡×™× ×•×Ÿ"
              aria-label="×¡×™× ×•×Ÿ"
            >
              â˜°
            </button>
            <div class="dropdown-menu dropdown-menu-end p-3" style="min-width: 280px;">
              <div class="mb-2">
                <label for="yearFilter" class="form-label mb-1">×©× ×”</label>
                <select id="yearFilter" class="form-select" onchange="applyFilters()">
                  <option value="">×›×œ ×”×©× ×™×</option>
                </select>
              </div>

              <div class="mb-2">
                <label for="ratingFilter" class="form-label mb-1">×“×™×¨×•×’ IMDb</label>
                <select id="ratingFilter" class="form-select" onchange="applyFilters()">
                  <option value="0">×›×œ ×”×“×™×¨×•×’×™×</option>
                  <option value="9">9 ×•××¢×œ×”</option>
                  <option value="8">8 ×•××¢×œ×”</option>
                  <option value="7">7 ×•××¢×œ×”</option>
                  <option value="6">6 ×•××¢×œ×”</option>
                </select>
              </div>

              <div class="mb-2">
                <label for="genreFilter" class="form-label mb-1">×–'×× ×¨</label>
                <select id="genreFilter" class="form-select" onchange="applyFilters()">
                  <option value="">×›×œ ×”×–'×× ×¨×™×</option>
                </select>
              </div>

              <div class="mb-2">
                <label for="pgFilter" class="form-label mb-1">×¡×•×’ ×§×”×œ</label>
                <select id="pgFilter" class="form-select" onchange="applyFilters()">
                  <option value="">×›×œ ×¡×•×’×™ ×”×§×”×œ</option>
                </select>
              </div>

            </div>
          </div>
        </div>
      </div>

      <div class="text-center mb-4">
        <button id="toggleViewBtn" class="btn btn-outline-primary">
          ğŸ“º ××¢×‘×¨ ×œ×ª×¦×•×’×ª ×¡×“×¨×•×ª
        </button>
      </div>

      <div id="moviecontainer" class="row row-cols-1 row-cols-md-2 g-4"></div>
    </div>

    <a
      href="https://docs.google.com/forms/d/e/1FAIpQLSePUwUmQBi4iJN5FjptxlrWIuDG7z1FEe7lSyVmBkzo6eRVMw/viewform?usp=dialog"
      target="_blank"
      class="bug-report-button"
      data-tooltip="×˜×•×¤×¡ ×ª×§×œ×•×ª<br>×“×™×•×•×— ×¢×œ ×¤×¨×§/×¡×¨×˜"
    >
      âš ï¸
    </a>

  </div>

  <!-- ×¡×¤×¨×™×•×ª -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <!-- ×”×§×•×“ ×©×œ ×”××ª×¨ -->
  <script src="main.js"></script>

</body>
</html>
