<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <title>ğŸ¬ ×¡×¨×˜×™× ×œ×¦×¤×™×™×”</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <!-- PapaParse × ×˜×¢×Ÿ ××¨××© -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

    <style>
        html { visibility: hidden; }
        body { background: #f7f7f7; }

        #blockScreen {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            background: white;
            z-index: 99999;
            padding: 40px;
            text-align: center;
        }
        #blockScreen h1 { font-size: 32px; margin-bottom: 20px; }
        #blockScreen p  { font-size: 20px; color: #555; }
    </style>

    <script>
        /*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           CONFIG â€“ ×˜×‘×œ×ª ××™×™×œ×™× ××•×¨×©×™×
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
        const GOOGLE_CLIENT_ID = "1083389812447-mst37a55gquvk05cuc8utqsuunfar6hb.apps.googleusercontent.com";

        const AUTH_SHEET_ID  = "1EYGrBVteGM4_kXhc6owSxicwIrMp6FkzV74AjZdeAeM";
        const AUTH_GID       = "0";
        const AUTH_CSV_URL   = `https://docs.google.com/spreadsheets/d/${AUTH_SHEET_ID}/export?format=csv&gid=${AUTH_GID}`;

        /*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           ×”×¦×’×ª ××¡×š ×—×¡×™××”
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
        function showBlockScreen() {
            document.getElementById("blockScreen").style.display = "block";
            document.documentElement.style.visibility = "visible";
        }

        /*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           Callback ××’×•×’×œ
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
        async function handleCredentialResponse(response) {
            try {
                const data = parseJwt(response.credential);
                const email = data.email;

                const allowed = await isEmailAllowed(email);
                if (!allowed) {
                    localStorage.removeItem("gs_auth_email");
                    return showBlockScreen();
                }

                localStorage.setItem("gs_auth_email", email);

                // ×˜×•×¢×Ÿ ××ª ×”Ö¾main.js ×¨×§ ××—×¨×™ ×”×¦×œ×—×”!
                loadApp();

            } catch (e) {
                console.error("Login error:", e);
                showBlockScreen();
            }
        }

        function parseJwt(token) {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(c =>
                '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)
            ).join(''));
            return JSON.parse(jsonPayload);
        }

        /*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           ×”×ª×—×‘×¨×•×ª ×× ××™×Ÿ ×©××•×¨
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
        async function startLoginFlow() {
            const saved = localStorage.getItem("gs_auth_email");
            if (saved) {
                const ok = await isEmailAllowed(saved);
                if (ok) return loadApp();
                else localStorage.removeItem("gs_auth_email");
            }

            google.accounts.id.initialize({
                client_id: GOOGLE_CLIENT_ID,
                callback: handleCredentialResponse
            });

            google.accounts.id.renderButton(
                document.getElementById("gLoginBtn"),
                { theme: "outline", size: "large" }
            );

            document.documentElement.style.visibility = "visible";
        }

        /*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           ×˜×¢×™× ×ª ×”××ª×¨ ×œ××—×¨ ×”×ª×—×‘×¨×•×ª
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
        function loadApp() {
            document.documentElement.style.visibility = "visible";

            // ×˜×•×¢×Ÿ ××ª main.js
            const s = document.createElement("script");
            s.src = "main.js?v=" + Date.now();
            document.body.appendChild(s);

            // ××¦×™×’ ××ª ×”×ª×•×›×Ÿ
            document.getElementById("appContent").style.display = "block";
        }

        window.onload = startLoginFlow;
    </script>
</head>

<body class="bg-light">

    <div id="blockScreen">
        <h1>ğŸš« ××™×Ÿ ×’×™×©×”</h1>
        <p>×”××™×™×œ ×©×œ×š ×œ× ×××•×©×¨.</p>
    </div>

    <div id="gLoginBtn" style="margin: 40px auto; width: fit-content;"></div>

    <div id="appContent" style="display:none;">
        <div class="container py-5">
            <h1 class="text-center mb-4">ğŸ¬ ×”×¡×¨×˜×™× ×©×œ× ×•</h1>

            <div class="text-center mb-4">
                <button id="toggleViewBtn" class="btn btn-outline-primary">
                    ğŸ“º ××¢×‘×¨ ×œ×ª×¦×•×’×ª ×¡×“×¨×•×ª
                </button>
            </div>

            <div class="filter-bar text-center mb-4">
                <input type="text" id="searchInput" class="form-control" placeholder="×—×™×¤×•×©..." oninput="applyFilters()">
                <select id="yearFilter" class="form-select mt-2" onchange="applyFilters()"></select>
                <select id="ratingFilter" class="form-select mt-2" onchange="applyFilters()">
                    <option value="0">×›×œ ×”×“×™×¨×•×’×™×</option>
                    <option value="9">9 ×•××¢×œ×”</option>
                    <option value="8">8 ×•××¢×œ×”</option>
                    <option value="7">7 ×•××¢×œ×”</option>
                    <option value="6">6 ×•××¢×œ×”</option>
                </select>
                <select id="genreFilter" class="form-select mt-2" onchange="applyFilters()"></select>
                <select id="pgFilter" class="form-select mt-2" onchange="applyFilters()"></select>
            </div>

            <div id="moviecontainer" class="row row-cols-1 row-cols-md-2 g-4"></div>
        </div>

        <!-- ×¡×¤×¨×™×•×ª ×¦×“ ×©×œ×™×©×™ -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    </div>

</body>
</html>
